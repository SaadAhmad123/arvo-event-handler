<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>ArvoMachine: Core Components and Event Emission | arvo-event-handler</title><meta name="description" content="Documentation for arvo-event-handler"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><link rel="stylesheet" href="../assets/typedoc-github-style.css"/></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base=".."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">arvo-event-handler</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">arvo-event-handler</a></li><li><a href="ArvoMachine__Core_Components_and_Event_Emission.html">ArvoMachine: Core Components and Event Emission</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="md:arvomachine-core-components-and-event-emission" class="tsd-anchor"></a><h1 class="tsd-anchor-link">ArvoMachine: Core Components and Event Emission<a href="#md:arvomachine-core-components-and-event-emission" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Arvo Machine is a specialized variant of the XState machine, designed to work seamlessly within the Arvo event-driven architecture. It is run by the Arvo Orchestrator and consists of three core components: <code>setupArvoMachine</code>, <code>setupArvoMachine.createMachine</code>, and the <code>ArvoMachine</code> class itself. This document provides an in-depth look at these components and how they work together to create and manage state machines in Arvo.</p>
<a id="md:setuparvomachine-laying-the-foundation" class="tsd-anchor"></a><h2 class="tsd-anchor-link"><code>setupArvoMachine</code>: Laying the Foundation<a href="#md:setuparvomachine-laying-the-foundation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><code>setupArvoMachine</code> is a critical function that establishes the groundwork for creating Arvo-compatible state machines. Its primary role is to configure the core elements of an Arvo state machine while enforcing Arvo-specific constraints and features.</p>
<p>One of the key aspects of <code>setupArvoMachine</code> is its emphasis on synchronous behavior. By design, Arvo machines do not support asynchronous features like XState actors or delay transitions. This constraint ensures predictable state transitions and maintains the deterministic nature of the event-driven system.</p>
<p>In addition to enforcing synchronicity, <code>setupArvoMachine</code> also implements built-in actions specific to Arvo, such as <code>enqueueArvoEvent</code>. This action allows the machine to enqueue events for processing by the Arvo Orchestrator.</p>
<p>Moreover, it allows for contracts to be bound to the machine context, making the machine aware of the events it can emit and receive. It's important to note that while the <code>ArvoOrchestrator</code> enforces strict gatekeeping logic on the input events of the machine based on the contracts, the machine itself allows emitting any kind of event.</p>
<p>The contract binding in <code>setupArvoMachine</code> serves several critical purposes:</p>
<ol>
<li>
<p><strong>Type Safety</strong>: By explicitly defining the events the machine can emit and receive, the contracts provide strong type safety. This helps catch potential errors at compile-time and ensures the machine operates within the defined boundaries of the Arvo system.</p>
</li>
<li>
<p><strong>Explainability</strong>: The contract interface makes the event-driven system more explainable and deterministic. It clearly defines the expected behavior and interactions of the machine, making the system easier to understand and reason about.</p>
</li>
<li>
<p><strong>Decoupling</strong>: The contracts allow for a decoupled architecture where the machine implementation can evolve independently of the consumers. As long as the contract is adhered to, the internal implementation details can change without affecting the rest of the system.</p>
</li>
</ol>
<p>Here's an example of how you might use <code>setupArvoMachine</code>:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">setup</span><span class="hl-1"> = </span><span class="hl-0">setupArvoMachine</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">contracts:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">self:</span><span class="hl-1"> </span><span class="hl-5">selfContract</span><span class="hl-1">.</span><span class="hl-0">version</span><span class="hl-1">(</span><span class="hl-2">&#39;0.0.1&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-5">services:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">service1:</span><span class="hl-1"> </span><span class="hl-5">serviceContract1</span><span class="hl-1">.</span><span class="hl-0">version</span><span class="hl-1">(</span><span class="hl-2">&#39;0.0.1&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">      </span><span class="hl-5">service2:</span><span class="hl-1"> </span><span class="hl-5">serviceContract2</span><span class="hl-1">.</span><span class="hl-0">version</span><span class="hl-1">(</span><span class="hl-2">&#39;0.0.1&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">types:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">context:</span><span class="hl-1"> {} </span><span class="hl-4">as</span><span class="hl-1"> </span><span class="hl-9">YourContextType</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">actions:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">customAction</span><span class="hl-5">:</span><span class="hl-1"> ({ </span><span class="hl-5">context</span><span class="hl-1">, </span><span class="hl-5">event</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">// Your custom action logic</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">guards:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">customGuard</span><span class="hl-5">:</span><span class="hl-1"> ({ </span><span class="hl-5">context</span><span class="hl-1">, </span><span class="hl-5">event</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">// Your custom guard logic</span><br/><span class="hl-1">      </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">; </span><span class="hl-3">// or false</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>The <code>contracts</code> parameter is particularly important as it defines the self contract and service contracts the machine will adhere to. The <code>self</code> contract specifies the version of the contract the machine implements, ensuring compatibility with the expected interface.</p>
<p>The <code>services</code> contracts define the events the machine emits and regards as services. Interestingly, the event handlers for these contracts don't need to be present during the implementation phase. This allows for a fully decoupled system where the contract interface provides the necessary abstraction and definition of behavior.</p>
<a id="md:setuparvomachinecreatemachine-constructing-the-machine" class="tsd-anchor"></a><h2 class="tsd-anchor-link">setupArvoMachine.createMachine: Constructing the Machine<a href="#md:setuparvomachinecreatemachine-constructing-the-machine" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Once the foundation is laid with <code>setupArvoMachine</code>, the next step is to actually create the Arvo-compatible state machine. This is where <code>setupArvoMachine.createMachine</code> comes into play.</p>
<p><code>createMachine</code> takes a machine configuration object and returns an <code>ArvoMachine</code> instance. During this process, it performs additional checks to ensure the machine adheres to Arvo's constraints. Notably, it disallows the use of 'invoke' and 'after' configurations, as these introduce asynchronous behavior.</p>
<p>Here's an example of using <code>createMachine</code>:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">machine</span><span class="hl-1"> = </span><span class="hl-5">setup</span><span class="hl-1">.</span><span class="hl-0">createMachine</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">id:</span><span class="hl-1"> </span><span class="hl-2">&#39;myMachine&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">context</span><span class="hl-5">:</span><span class="hl-1"> ({ </span><span class="hl-5">input</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">    </span><span class="hl-3">// Initial context based on input</span><br/><span class="hl-1">  }),</span><br/><span class="hl-1">  </span><span class="hl-0">output</span><span class="hl-5">:</span><span class="hl-1"> ({</span><span class="hl-5">context</span><span class="hl-1">}) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({ ... }),</span><br/><span class="hl-1">  </span><span class="hl-5">initial:</span><span class="hl-1"> </span><span class="hl-2">&#39;initialState&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">states:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">initialState:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">on:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">&#39;com.test.test&#39;</span><span class="hl-5">:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-5">target:</span><span class="hl-1"> </span><span class="hl-2">&#39;nextState&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-5">actions:</span><span class="hl-1"> [</span><span class="hl-2">&#39;customAction&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-5">nextState:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">// ...</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>The machine configuration includes a unique <code>id</code>, the <code>version</code> of the machine (which must match the version in the self contract), an initial <code>context</code>, the <code>initial</code> state, and the <code>states</code> of the machine.</p>
<a id="md:arvomachine-the-arvo-compatible-state-machine" class="tsd-anchor"></a><h2 class="tsd-anchor-link">ArvoMachine: The Arvo-Compatible State Machine<a href="#md:arvomachine-the-arvo-compatible-state-machine" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The end result of using <code>setupArvoMachine</code> and <code>createMachine</code> is an instance of the <code>ArvoMachine</code> class. This class represents an Arvo-compatible state machine that can be consumed by an Arvo Orchestrator.</p>
<p>An <code>ArvoMachine</code> combines XState's actor logic with Arvo-specific contracts and versioning information. It encapsulates all the necessary logic and metadata required for the Arvo Orchestrator to execute the machine as part of an event-driven workflow.</p>
<p>While it's possible to create an <code>ArvoMachine</code> instance directly, it's strongly recommended to use the <code>setupArvoMachine().createMachine()</code> method instead. This ensures that all Arvo-specific constraints and setup are properly applied.</p>
<p>Here's how you might interact with an <code>ArvoMachine</code> instance:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">arvoMachine</span><span class="hl-1"> = </span><span class="hl-5">setup</span><span class="hl-1">.</span><span class="hl-0">createMachine</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">// Machine configuration</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-5">arvoMachine</span><span class="hl-1">.</span><span class="hl-5">id</span><span class="hl-1">); </span><span class="hl-3">// Access the machine&#39;s ID</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-5">arvoMachine</span><span class="hl-1">.</span><span class="hl-5">version</span><span class="hl-1">); </span><span class="hl-3">// Access the machine&#39;s version</span><br/><span class="hl-3">// Use arvoMachine in your Arvo Orchestrator</span>
</code><button type="button">Copy</button></pre>

<a id="md:event-emission-emit-vs-enqueuearvoevent-with-domain-routing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Event Emission: 'emit' vs 'enqueueArvoEvent' with Domain Routing<a href="#md:event-emission-emit-vs-enqueuearvoevent-with-domain-routing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>When emitting events in Arvo, there are two primary methods: <code>emit</code> and <code>enqueueArvoEvent</code>. Both support domain-based routing for sophisticated workflow patterns including human-in-the-loop operations, external system integrations, and custom processing pipelines.</p>
<a id="md:using-emit-with-domains" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Using 'emit' with Domains<a href="#md:using-emit-with-domains" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>emit</code> function should be used when emitting events that are explicitly defined in your service contracts. It provides strict schema validation and type safety, with optional domain assignment for specialized routing:</p>
<pre><code class="typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">xstate</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;arvo-xstate&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">llmMachine</span><span class="hl-1"> = </span><span class="hl-0">setupArvoMachine</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">// ... other configuration</span><br/><span class="hl-1">}).</span><span class="hl-0">createMachine</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">// ... other machine config</span><br/><span class="hl-1">  </span><span class="hl-5">states:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">someState:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">entry:</span><span class="hl-1"> [</span><br/><span class="hl-1">        </span><span class="hl-3">// Standard internal processing</span><br/><span class="hl-1">        </span><span class="hl-5">xstate</span><span class="hl-1">.</span><span class="hl-0">emit</span><span class="hl-1">(({ </span><span class="hl-5">context</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">          </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;com.openai.completions&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-5">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-5">request:</span><span class="hl-1"> </span><span class="hl-5">context</span><span class="hl-1">.</span><span class="hl-5">request</span><span class="hl-1">,</span><br/><span class="hl-1">          },</span><br/><span class="hl-1">        })),</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-3">// External system integration</span><br/><span class="hl-1">        </span><span class="hl-5">xstate</span><span class="hl-1">.</span><span class="hl-0">emit</span><span class="hl-1">(({ </span><span class="hl-5">context</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">          </span><span class="hl-5">domains:</span><span class="hl-1"> [</span><span class="hl-2">&#39;external&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">          </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;com.approval.request&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-5">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-5">request:</span><span class="hl-1"> </span><span class="hl-5">context</span><span class="hl-1">.</span><span class="hl-5">request</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-5">amount:</span><span class="hl-1"> </span><span class="hl-5">context</span><span class="hl-1">.</span><span class="hl-5">amount</span><span class="hl-1">,</span><br/><span class="hl-1">          },</span><br/><span class="hl-1">        })),</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-3">// Multi-domain event for parallel processing</span><br/><span class="hl-1">        </span><span class="hl-5">xstate</span><span class="hl-1">.</span><span class="hl-0">emit</span><span class="hl-1">(({ </span><span class="hl-5">context</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">          </span><span class="hl-5">domains:</span><span class="hl-1"> [</span><span class="hl-2">&#39;default&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;analytics&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;audit&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">          </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;com.transaction.completed&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-5">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-5">transactionId:</span><span class="hl-1"> </span><span class="hl-5">context</span><span class="hl-1">.</span><span class="hl-5">transactionId</span><span class="hl-1">,</span><br/><span class="hl-1">          },</span><br/><span class="hl-1">        })),</span><br/><span class="hl-1">      ],</span><br/><span class="hl-1">      </span><span class="hl-3">// ... other state config</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:using-enqueuearvoevent-with-domains" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Using 'enqueueArvoEvent' with Domains<a href="#md:using-enqueuearvoevent-with-domains" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>enqueueArvoEvent</code> should be used for events not explicitly defined in your service contracts, and also supports domain routing:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">llmMachine</span><span class="hl-1"> = </span><span class="hl-0">setupArvoMachine</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">// ... other configuration</span><br/><span class="hl-1">  </span><span class="hl-5">actions:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">emitDynamicEvent</span><span class="hl-5">:</span><span class="hl-1"> ({ </span><span class="hl-5">context</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">      </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;enqueueArvoEvent&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">params:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-5">domains:</span><span class="hl-1"> [</span><span class="hl-2">&#39;external&#39;</span><span class="hl-1">], </span><span class="hl-3">// Route to external processing</span><br/><span class="hl-1">        </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;com.dynamic.event&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-5">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-5">dynamicField:</span><span class="hl-1"> </span><span class="hl-5">context</span><span class="hl-1">.</span><span class="hl-5">someValue</span><span class="hl-1">,</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    }),</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">}).</span><span class="hl-0">createMachine</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">// ... other machine config</span><br/><span class="hl-1">  </span><span class="hl-5">states:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">someState:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">entry:</span><span class="hl-1"> [</span><span class="hl-2">&#39;emitDynamicEvent&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">      </span><span class="hl-3">// ... other state config</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:multiple-events-for-multiple-domains" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Multiple Events for Multiple Domains<a href="#md:multiple-events-for-multiple-domains" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>To create separate events for different domains (rather than one event in multiple domains), use multiple emit calls:</p>
<pre><code class="typescript"><span class="hl-3">// Creates two separate events with different IDs</span><br/><span class="hl-12">entry</span><span class="hl-1">: [</span><br/><span class="hl-1">  </span><span class="hl-5">xstate</span><span class="hl-1">.</span><span class="hl-0">emit</span><span class="hl-1">(({ </span><span class="hl-5">context</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">    </span><span class="hl-5">domains:</span><span class="hl-1"> [</span><span class="hl-2">&#39;default&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;com.process.standard&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">data:</span><span class="hl-1"> { </span><span class="hl-5">request:</span><span class="hl-1"> </span><span class="hl-5">context</span><span class="hl-1">.</span><span class="hl-5">request</span><span class="hl-1"> },</span><br/><span class="hl-1">  })),</span><br/><span class="hl-1">  </span><span class="hl-5">xstate</span><span class="hl-1">.</span><span class="hl-0">emit</span><span class="hl-1">(({ </span><span class="hl-5">context</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">    </span><span class="hl-5">domains:</span><span class="hl-1"> [</span><span class="hl-2">&#39;external&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;com.process.approval&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">data:</span><span class="hl-1"> { </span><span class="hl-5">request:</span><span class="hl-1"> </span><span class="hl-5">context</span><span class="hl-1">.</span><span class="hl-5">request</span><span class="hl-1"> },</span><br/><span class="hl-1">  })),</span><br/><span class="hl-1">],</span>
</code><button type="button">Copy</button></pre>

<a id="md:best-practices" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Best Practices<a href="#md:best-practices" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Always prefer <code>emit</code> when possible for better type safety and validation. Use <code>enqueueArvoEvent</code> sparingly and only when dealing with truly dynamic or external events. When using either method:</p>
<ul>
<li>Specify domains explicitly when events need specialized routing</li>
<li>Use multiple emit calls when you need separate events rather than one event in multiple domains</li>
<li>Consider the downstream processing requirements when choosing domain assignments</li>
<li>Add runtime checks when using <code>enqueueArvoEvent</code> to ensure emitted events meet system requirements</li>
</ul>
<a id="md:resource-locking-and-parallel-states" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Resource Locking and Parallel States<a href="#md:resource-locking-and-parallel-states" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>ArvoMachine optimizes its distributed execution through automatic analysis of state machine structure. During creation, it analyzes the machine configuration to determine if distributed resource locking is necessary by detecting the presence of parallel states.</p>
<p>When a machine contains no parallel states or none of the services it uses emit parallel events, its execution is inherently sequential - state transitions happen one after another without possibility of race conditions. In these cases, ArvoMachine automatically sets <code>requiresResourceLocking</code> to false, eliminating unnecessary distributed lock overhead.</p>
<p>For machines with parallel states or event emissions where multiple states can be active simultaneously, the locking mechanism remains enabled to ensure safe concurrent operations.</p>
<p>This locking flag is passed to implementations of the <code>IMachineMemory</code> interface, allowing memory managers to implement appropriate locking strategies based on their specific requirements. The entire process is automatic and requires no additional configuration from developers.</p>
<a id="md:domain-based-event-processing-in-arvomachine" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Domain-Based Event Processing in ArvoMachine<a href="#md:domain-based-event-processing-in-arvomachine" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>ArvoMachine events can be categorized into processing domains, enabling sophisticated orchestration patterns. Events without explicit domains are automatically assigned to the 'default' domain for standard internal processing.</p>
<a id="md:domain-assignment" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Domain Assignment<a href="#md:domain-assignment" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Events emitted from ArvoMachine states can specify their processing domains:</p>
<pre><code class="typescript"><span class="hl-3">// Event assigned to default domain (automatic)</span><br/><span class="hl-5">xstate</span><span class="hl-1">.</span><span class="hl-0">emit</span><span class="hl-1">(({ </span><span class="hl-5">context</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">  </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;com.service.call&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">data:</span><span class="hl-1"> { </span><span class="hl-5">request:</span><span class="hl-1"> </span><span class="hl-5">context</span><span class="hl-1">.</span><span class="hl-5">request</span><span class="hl-1"> }</span><br/><span class="hl-1">}))</span><br/><br/><span class="hl-3">// Event assigned to external domain</span><br/><span class="hl-5">xstate</span><span class="hl-1">.</span><span class="hl-0">emit</span><span class="hl-1">(({ </span><span class="hl-5">context</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">  </span><span class="hl-5">domains:</span><span class="hl-1"> [</span><span class="hl-2">&#39;external&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;com.approval.request&#39;</span><span class="hl-1">, </span><br/><span class="hl-1">  </span><span class="hl-5">data:</span><span class="hl-1"> { </span><span class="hl-5">amount:</span><span class="hl-1"> </span><span class="hl-5">context</span><span class="hl-1">.</span><span class="hl-5">amount</span><span class="hl-1"> }</span><br/><span class="hl-1">}))</span>
</code><button type="button">Copy</button></pre>

<a id="md:orchestrator-integration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Orchestrator Integration<a href="#md:orchestrator-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The ArvoOrchestrator processes domain-assigned events and returns them in structured buckets, enabling downstream systems to handle different domains with specialized logic. This separation allows for clean integration between automated processing, human-in-the-loop workflows, and external system integrations while maintaining the machine's simplicity and focus on business logic.</p>
<a id="md:conclusion" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Conclusion<a href="#md:conclusion" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The Arvo Machine, composed of <code>setupArvoMachine</code>, <code>createMachine</code>, and the <code>ArvoMachine</code> class, forms the backbone of creating state machines in the Arvo event-driven architecture. By understanding these components and how to properly emit events, you can build robust, type-safe, and Arvo-compatible state machines for your event-driven systems.</p>
<p>Remember, the Arvo Machine is designed to work hand-in-hand with the Arvo Orchestrator. The Orchestrator consumes Arvo Machines and executes them as part of larger, event-driven workflows. By adhering to the principles and best practices outlined in this guide, you can ensure your state machines integrate seamlessly into the Arvo ecosystem.</p>
<a id="md:additional-information" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Additional Information<a href="#md:additional-information" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>A more detailed information is provided <a href="https://github.com/SaadAhmad123/arvo-xstate/blob/main/src/ArvoMachine/ExecutionDiagrams.md" target="_blank" class="external">here</a> on machine input validation which is used by the orchestrator to perform gatekeeping actions.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:arvomachine-core-components-and-event-emission"><span>Arvo<wbr/>Machine: <wbr/>Core <wbr/>Components and <wbr/>Event <wbr/>Emission</span></a><ul><li><a href="#md:setuparvomachine-laying-the-foundation"><span>setup<wbr/>Arvo<wbr/>Machine: <wbr/>Laying the <wbr/>Foundation</span></a></li><li><a href="#md:setuparvomachinecreatemachine-constructing-the-machine"><span>setup<wbr/>Arvo<wbr/>Machine.create<wbr/>Machine: <wbr/>Constructing the <wbr/>Machine</span></a></li><li><a href="#md:arvomachine-the-arvo-compatible-state-machine"><span>Arvo<wbr/>Machine: <wbr/>The <wbr/>Arvo-<wbr/>Compatible <wbr/>State <wbr/>Machine</span></a></li><li><a href="#md:event-emission-emit-vs-enqueuearvoevent-with-domain-routing"><span>Event <wbr/>Emission: &#39;emit&#39; vs &#39;enqueue<wbr/>Arvo<wbr/>Event&#39; with <wbr/>Domain <wbr/>Routing</span></a></li><li><ul><li><a href="#md:using-emit-with-domains"><span>Using &#39;emit&#39; with <wbr/>Domains</span></a></li><li><a href="#md:using-enqueuearvoevent-with-domains"><span>Using &#39;enqueue<wbr/>Arvo<wbr/>Event&#39; with <wbr/>Domains</span></a></li><li><a href="#md:multiple-events-for-multiple-domains"><span>Multiple <wbr/>Events for <wbr/>Multiple <wbr/>Domains</span></a></li><li><a href="#md:best-practices"><span>Best <wbr/>Practices</span></a></li></ul></li><li><a href="#md:resource-locking-and-parallel-states"><span>Resource <wbr/>Locking and <wbr/>Parallel <wbr/>States</span></a></li><li><a href="#md:domain-based-event-processing-in-arvomachine"><span>Domain-<wbr/>Based <wbr/>Event <wbr/>Processing in <wbr/>Arvo<wbr/>Machine</span></a></li><li><ul><li><a href="#md:domain-assignment"><span>Domain <wbr/>Assignment</span></a></li><li><a href="#md:orchestrator-integration"><span>Orchestrator <wbr/>Integration</span></a></li></ul></li><li><a href="#md:conclusion"><span>Conclusion</span></a></li><li><a href="#md:additional-information"><span>Additional <wbr/>Information</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-1"></use></svg><span>arvo-event-handler</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base=".."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a> with <a href="https://github.com/KillerJulian/typedoc-github-theme" target="_blank">typedoc-github-theme</a></p></footer><div class="overlay"></div></body></html>
