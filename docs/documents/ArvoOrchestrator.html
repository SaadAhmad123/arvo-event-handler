<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>ArvoOrchestrator | arvo-event-handler</title><meta name="description" content="Documentation for arvo-event-handler"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><link rel="stylesheet" href="../assets/typedoc-github-style.css"/></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base=".."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">arvo-event-handler</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">arvo-event-handler</a></li><li><a href="ArvoOrchestrator.html">ArvoOrchestrator</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="md:arvoorchestrator" class="tsd-anchor"></a><h1 class="tsd-anchor-link">ArvoOrchestrator<a href="#md:arvoorchestrator" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="md:overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Overview<a href="#md:overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>ArvoOrchestrator</code> serves as the cornerstone of the Arvo state machine workflow system, orchestrating the intricate dance between state machine execution, lifecycle management, and event processing. At its heart, it coordinates three essential components: the Machine Registry for definition management, Machine Memory for state persistence, and the Execution Engine for processing logic. This harmonious integration enables robust workflow management while maintaining comprehensive telemetry and error handling.</p>
<a id="md:getting-started" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Getting Started<a href="#md:getting-started" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Begin your journey with Arvo through a straightforward initialization process. The following example demonstrates setting up a basic orchestrator with two machines:</p>
<pre><code class="typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">createArvoOrchestrator</span><span class="hl-1">, </span><span class="hl-5">SimpleMachineMemory</span><span class="hl-1">, </span><span class="hl-5">setupArvoMachine</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;arvo-xstate&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">machine1</span><span class="hl-1"> = </span><span class="hl-0">setupArvoMachine</span><span class="hl-1">(...).</span><span class="hl-0">createMachine</span><span class="hl-1">(...);</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">machine2</span><span class="hl-1"> = </span><span class="hl-0">setupArvoMachine</span><span class="hl-1">(...).</span><span class="hl-0">createMachine</span><span class="hl-1">(...);</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">orchestrator</span><span class="hl-1"> = </span><span class="hl-0">createArvoOrchestrator</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">memory:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">SimpleMachineMemory</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-5">executionunits:</span><span class="hl-1"> </span><span class="hl-8">1</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">machines:</span><span class="hl-1"> [</span><span class="hl-5">machine1</span><span class="hl-1">, </span><span class="hl-5">machine2</span><span class="hl-1">]</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Process an event - now returns structured result</span><br/><span class="hl-6">const</span><span class="hl-1"> { </span><span class="hl-7">events</span><span class="hl-1"> } = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">orchestrator</span><span class="hl-1">.</span><span class="hl-0">execute</span><span class="hl-1">(</span><span class="hl-5">incomingEvent</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:multi-domain-event-broadcasting" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Multi-Domain Event Broadcasting<a href="#md:multi-domain-event-broadcasting" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The ArvoOrchestrator supports sophisticated multi-domain event distribution through array-based domain specification. This powerful feature allows events to be broadcast across multiple processing contexts simultaneously.</p>
<a id="md:understanding-domains" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Understanding Domains<a href="#md:understanding-domains" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>In Arvo, domains represent different processing contexts or routing namespaces for events. They enable sophisticated event distribution patterns where a single handler response can create multiple events for different processing pipelines.</p>
<a id="md:domain-assignment-rules" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Domain Assignment Rules<a href="#md:domain-assignment-rules" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>When returning events from a state machine, you can specify domains using the <code>domain</code> field:</p>
<ol>
<li><strong>Array Processing</strong>: Each element in the <code>domain</code> array creates a separate ArvoEvent instance</li>
<li><strong><code>undefined</code> in Array Resolution</strong>: <code>undefined</code> elements resolve to: <code>event.contract.domain ?? triggeringEvent.domain ?? handler.contract.domain ?? null</code></li>
<li><strong><code>null</code> in Array Resolution</strong>: <code>null</code> elements resolve to events which <code>domain: null</code></li>
<li><strong>Automatic Deduplication</strong>: Duplicate domains are automatically removed to prevent redundant events</li>
<li><strong>Default Behavior</strong>: Omitting the <code>domain</code> field (or setting to <code>undefined</code>) defaults to <code>[null]</code> (single event, no domain)</li>
</ol>
<a id="md:domain-broadcasting-patterns" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Domain Broadcasting Patterns<a href="#md:domain-broadcasting-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">// In your state machine - creates 2 events: one for each domain</span><br/><span class="hl-5">xstate</span><span class="hl-1">.</span><span class="hl-0">emit</span><span class="hl-1">(({ </span><span class="hl-5">context</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">  </span><span class="hl-5">domains:</span><span class="hl-1"> [</span><span class="hl-2">&#39;domain1&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;domain2&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;com.service.call&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">data:</span><span class="hl-1"> { </span><span class="hl-5">request:</span><span class="hl-1"> </span><span class="hl-5">context</span><span class="hl-1">.</span><span class="hl-5">request</span><span class="hl-1"> }</span><br/><span class="hl-1">}))</span><br/><br/><span class="hl-3">// Creates up to 3 events:</span><br/><span class="hl-3">// - Event with domain: &#39;analytics&#39;</span><br/><span class="hl-3">// - Event with domain: event.contract.domain ?? triggeringEvent.domain ?? handler.contract.domain ?? null</span><br/><span class="hl-3">// - Event with domain: null</span><br/><span class="hl-5">xstate</span><span class="hl-1">.</span><span class="hl-0">emit</span><span class="hl-1">(({ </span><span class="hl-5">context</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">  </span><span class="hl-5">domains:</span><span class="hl-1"> [</span><span class="hl-2">&#39;analytics&#39;</span><span class="hl-1">, </span><span class="hl-6">undefined</span><span class="hl-1">, </span><span class="hl-6">null</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;com.process.update&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">data:</span><span class="hl-1"> { </span><span class="hl-5">status:</span><span class="hl-1"> </span><span class="hl-5">context</span><span class="hl-1">.</span><span class="hl-5">status</span><span class="hl-1"> }</span><br/><span class="hl-1">}))</span><br/><br/><span class="hl-3">// Single event with explicit no-domain routing</span><br/><span class="hl-5">xstate</span><span class="hl-1">.</span><span class="hl-0">emit</span><span class="hl-1">(({ </span><span class="hl-5">context</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">  </span><span class="hl-5">domains:</span><span class="hl-1"> [</span><span class="hl-6">null</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;com.standard.process&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">data:</span><span class="hl-1"> { </span><span class="hl-5">data:</span><span class="hl-1"> </span><span class="hl-5">context</span><span class="hl-1">.</span><span class="hl-5">data</span><span class="hl-1"> }</span><br/><span class="hl-1">}))</span><br/><br/><span class="hl-3">// Single event with no-domain (equivalent to omitting domain field)</span><br/><span class="hl-5">xstate</span><span class="hl-1">.</span><span class="hl-0">emit</span><span class="hl-1">(({ </span><span class="hl-5">context</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">  </span><span class="hl-5">domains:</span><span class="hl-1"> </span><span class="hl-6">undefined</span><span class="hl-1">, </span><span class="hl-3">// or omit domains entirely</span><br/><span class="hl-1">  </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;com.default.process&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">data:</span><span class="hl-1"> { </span><span class="hl-5">data:</span><span class="hl-1"> </span><span class="hl-5">context</span><span class="hl-1">.</span><span class="hl-5">data</span><span class="hl-1"> }</span><br/><span class="hl-1">}))</span>
</code><button type="button">Copy</button></pre>

<a id="md:error-broadcasting" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Error Broadcasting<a href="#md:error-broadcasting" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>System errors are automatically broadcast to all relevant processing contexts:</p>
<ul>
<li>Source event domain (<code>event.domain</code>)</li>
<li>Handler contract domain (<code>handler.contract.domain</code>)</li>
<li>No-domain context (<code>null</code>)</li>
</ul>
<p>Duplicates are automatically removed, so if <code>event.domain === handler.contract.domain</code>, only two error events are created instead of three.</p>
<a id="md:domain-usage-example" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Domain Usage Example<a href="#md:domain-usage-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">handler</span><span class="hl-1"> = </span><span class="hl-0">setupArvoMachine</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">contracts:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">self:</span><span class="hl-1"> </span><span class="hl-5">userContract</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">services:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">approvalService:</span><span class="hl-1"> </span><span class="hl-5">approvalContract</span><span class="hl-1">.</span><span class="hl-0">version</span><span class="hl-1">(</span><span class="hl-2">&#39;1.0.0&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">      </span><span class="hl-5">analyticsService:</span><span class="hl-1"> </span><span class="hl-5">analyticsContract</span><span class="hl-1">.</span><span class="hl-0">version</span><span class="hl-1">(</span><span class="hl-2">&#39;1.0.0&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-3">// ... other config</span><br/><span class="hl-1">}).</span><span class="hl-0">createMachine</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">// ... machine config</span><br/><span class="hl-1">  </span><span class="hl-5">states:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">processing:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">entry:</span><span class="hl-1"> [</span><br/><span class="hl-1">        </span><span class="hl-3">// Standard internal processing</span><br/><span class="hl-1">        </span><span class="hl-5">xstate</span><span class="hl-1">.</span><span class="hl-0">emit</span><span class="hl-1">(({ </span><span class="hl-5">context</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">          </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;com.approval.request&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-5">data:</span><span class="hl-1"> { </span><span class="hl-5">userId:</span><span class="hl-1"> </span><span class="hl-5">context</span><span class="hl-1">.</span><span class="hl-5">userId</span><span class="hl-1"> }</span><br/><span class="hl-1">        })),</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-3">// External system integration</span><br/><span class="hl-1">        </span><span class="hl-5">xstate</span><span class="hl-1">.</span><span class="hl-0">emit</span><span class="hl-1">(({ </span><span class="hl-5">context</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">          </span><span class="hl-5">domains:</span><span class="hl-1"> [</span><span class="hl-2">&#39;external&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">          </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;com.notification.send&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-5">data:</span><span class="hl-1"> { </span><span class="hl-5">message:</span><span class="hl-1"> </span><span class="hl-5">context</span><span class="hl-1">.</span><span class="hl-5">notification</span><span class="hl-1"> }</span><br/><span class="hl-1">        })),</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-3">// Multi-domain event for parallel processing</span><br/><span class="hl-1">        </span><span class="hl-5">xstate</span><span class="hl-1">.</span><span class="hl-0">emit</span><span class="hl-1">(({ </span><span class="hl-5">context</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">          </span><span class="hl-5">domains:</span><span class="hl-1"> [</span><span class="hl-2">&#39;analytics&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;audit&#39;</span><span class="hl-1">, </span><span class="hl-6">null</span><span class="hl-1">],</span><br/><span class="hl-1">          </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;com.user.action.logged&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-5">data:</span><span class="hl-1"> { </span><span class="hl-5">action:</span><span class="hl-1"> </span><span class="hl-5">context</span><span class="hl-1">.</span><span class="hl-5">action</span><span class="hl-1"> }</span><br/><span class="hl-1">        }))</span><br/><span class="hl-1">      ]</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:operation-overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Operation overview<a href="#md:operation-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>When an event arrives at the <code>ArvoOrchestrator</code>, it initiates a sophisticated sequence of operations. The process begins by establishing a telemetry context through OpenTelemetry instantiated via <code>ArvoOpenTelemetry.getInstance()</code> from <code>arvo-core</code>, enabling comprehensive monitoring of the execution lifecycle. The orchestrator then acquires an exclusive lock on the workflow subject, ensuring isolated execution and data consistency.</p>
<p>State retrieval follows lock acquisition, determining whether this is a new workflow initialization or the continuation of an existing execution. For new workflows, the orchestrator validates that the triggering event matches the expected initialization type. Existing workflows undergo proper routing to ensure the event reaches the correct instance.</p>
<p>The orchestrator resolves machine definitions through its registry, considering version requirements and compatibility. After validating input against established contracts, the execution engine processes the event within the machine's context. The resulting raw events undergo transformation and validation before emission as fully-formed Arvo events.</p>
<a id="md:event-routing-in-arvo-orchestrator" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Event Routing in Arvo Orchestrator<a href="#md:event-routing-in-arvo-orchestrator" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The Arvo Orchestrator implements a sophisticated event routing mechanism that manages event flow through the workflow system. The routing system operates at multiple levels, handling both direct workflow events and orchestrator-to-orchestrator communications through a parent-child relationship model.</p>
<a id="md:core-routing-logic" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Core Routing Logic<a href="#md:core-routing-logic" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Event routing in the orchestrator is primarily determined by three key fields in the event structure:</p>
<ul>
<li><code>type</code>: Determines the event's purpose and target handler</li>
<li><code>subject</code>: Contains orchestration routing information including version and chain data</li>
<li><code>to</code>: Specifies the final destination service for the event</li>
</ul>
<p>When an event arrives, the orchestrator first validates the subject format to ensure proper routing information. For new workflow instances, it verifies that the event type matches the orchestrator's source identifier. For existing workflows, it confirms that the subject's orchestrator name matches the current orchestrator, preventing misrouted events from causing unintended state changes.</p>
<a id="md:parent-child-workflow-routing" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Parent-Child Workflow Routing<a href="#md:parent-child-workflow-routing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The orchestrator supports hierarchical workflow execution through parent-child routing. When a workflow needs to trigger a sub-workflow, it includes a <code>parentSubject$$</code> in the event data. The orchestrator uses this information to maintain execution context across workflow boundaries, enabling complex workflow compositions while preserving execution isolation and state management.</p>
<a id="md:routing-control" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Routing Control<a href="#md:routing-control" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Events can influence their routing through several mechanisms:</p>
<ul>
<li><code>redirectto</code>: Overrides default routing for completion events</li>
<li><code>accesscontrol</code>: Carries permissions and routing restrictions</li>
<li><code>parsed(event.subject).meta.redirectto</code>: Provides routing hints for orchestration chains</li>
</ul>
<p>This comprehensive routing system ensures events are processed by the correct workflow instances while maintaining proper execution boundaries and workflow relationships.</p>
<a id="md:multi-domain-event-broadcasting-1" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Multi-Domain Event Broadcasting<a href="#md:multi-domain-event-broadcasting-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>ArvoOrchestrator</code> supports sophisticated multi-domain event distribution through symbolic domain specification. This powerful feature allows events to be broadcast across multiple processing contexts simultaneously, enabling advanced workflow patterns including human-in-the-loop operations, external system integrations, and custom processing pipelines.</p>
<a id="md:understanding-domains-with-symbolic-resolution" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Understanding Domains with Symbolic Resolution<a href="#md:understanding-domains-with-symbolic-resolution" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>In Arvo, domains represent different processing contexts or routing namespaces for events. The orchestrator uses symbolic constants from <code>ArvoDomain</code> to enable dynamic domain resolution based on execution context, making domain assignment both flexible and predictable.</p>
<p>When emitting events from state machines, you can specify domains using symbolic references that resolve at runtime:</p>
<pre><code class="typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">ArvoDomain</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;arvo-xstate&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">// In your state machine</span><br/><span class="hl-5">xstate</span><span class="hl-1">.</span><span class="hl-0">emit</span><span class="hl-1">(({ </span><span class="hl-5">context</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">  </span><span class="hl-3">// Standard internal processing (no domain)</span><br/><span class="hl-1">  </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;com.approval.request&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">data:</span><span class="hl-1"> { </span><span class="hl-5">userId:</span><span class="hl-1"> </span><span class="hl-5">context</span><span class="hl-1">.</span><span class="hl-5">userId</span><span class="hl-1"> }</span><br/><span class="hl-1">}))</span><br/><br/><span class="hl-3">// Multi-domain event with symbolic resolution</span><br/><span class="hl-5">xstate</span><span class="hl-1">.</span><span class="hl-0">emit</span><span class="hl-1">(({ </span><span class="hl-5">context</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">  </span><span class="hl-5">domains:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-5">ArvoDomain</span><span class="hl-1">.</span><span class="hl-7">FROM_TRIGGERING_EVENT</span><span class="hl-1">,  </span><span class="hl-3">// Inherit source event&#39;s domain</span><br/><span class="hl-1">    </span><span class="hl-2">&#39;analytics&#39;</span><span class="hl-1">,                       </span><span class="hl-3">// Explicit analytics domain</span><br/><span class="hl-1">    </span><span class="hl-6">null</span><span class="hl-1">                               </span><span class="hl-3">// Standard processing pipeline</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;com.user.action.logged&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">data:</span><span class="hl-1"> { </span><span class="hl-5">action:</span><span class="hl-1"> </span><span class="hl-5">context</span><span class="hl-1">.</span><span class="hl-5">action</span><span class="hl-1"> }</span><br/><span class="hl-1">}))</span>
</code><button type="button">Copy</button></pre>

<a id="md:domain-resolution-and-deduplication" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Domain Resolution and Deduplication<a href="#md:domain-resolution-and-deduplication" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The orchestrator automatically resolves symbolic domains and removes duplicates to ensure efficient event emission. For example, if <code>ArvoDomain.FROM_TRIGGERING_EVENT</code> resolves to <code>'user.processing'</code> and that's the same as the handler's contract domain, only one event is created instead of duplicates. This intelligent deduplication happens after domain resolution, ensuring optimal performance while maintaining the flexibility of symbolic domain specification.</p>
<p>Available symbolic constants include <code>FROM_TRIGGERING_EVENT</code> (inherit from source event), <code>FROM_SELF_CONTRACT</code> (use handler's domain), and <code>FROM_EVENT_CONTRACT</code> (use target service domain). You can mix these with explicit domain strings and <code>null</code> for comprehensive domain routing control.</p>
<a id="md:domain-context-in-parent-child-relationships" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Domain Context in Parent-Child Relationships<a href="#md:domain-context-in-parent-child-relationships" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><strong>Parent orchestrator</strong> operates in one domain (e.g., <code>'internal'</code>)</li>
<li><strong>Child orchestrator</strong> might operate in a different domain (e.g., <code>'external'</code>)</li>
<li>When the child completes, its completion event is routed back to the <strong>parent's domain context</strong></li>
<li>Each orchestrator can operate in its own domain regardless of parent-child relationship</li>
</ul>
<a id="md:detailed-component-integration-and-operation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Detailed Component Integration and Operation<a href="#md:detailed-component-integration-and-operation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The Lock Management system provides critical execution isolation through the Machine Memory interface. Upon event arrival, the orchestrator acquires an exclusive lock, preventing concurrent modifications to workflow instances. This distributed locking mechanism ensures data consistency throughout the execution cycle. Lock acquisition failures, whether due to existing locks or system issues, trigger appropriate error events and execution termination. The lock persists through the entire execution, protecting all state transitions and modifications until a robust cleanup process ensures proper release.</p>
<p>State Management forms the foundation of workflow processing. After securing execution locks, the orchestrator retrieves the current workflow state, including execution status, values, and machine snapshots. The system performs comprehensive validation to ensure state consistency and compatibility with incoming events and machine versions. New instances undergo initialization with strict validation protocols, while existing workflows receive careful compatibility checks. State persistence occurs atomically after successful processing, with thorough validation ensuring data integrity throughout the workflow lifecycle.</p>
<p>Event Processing follows a rigorous pipeline of validation and transformation. Each incoming event undergoes multiple validation stages to verify subject format, contract compliance, and business rules. The Machine Registry handles sophisticated event routing based on version and type information, ensuring proper workflow targeting. Event transformation maintains data integrity while converting raw machine events into fully-formed Arvo events, preserving ordering guarantees crucial for distributed scenarios.</p>
<p>Here's an addition to the documentation explaining the error handling approach:</p>
<a id="md:error-handling-philosophy-transaction-errors-vs-system-error-events" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Error Handling Philosophy: Transaction Errors vs System Error Events<a href="#md:error-handling-philosophy-transaction-errors-vs-system-error-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The ArvoOrchestrator implements a carefully designed dual-layered error handling strategy that distinguishes between transaction errors and system error events. This separation reflects a fundamental principle in distributed systems: infrastructure failures should be handled differently from workflow-level errors.</p>
<p>Transaction errors, implemented through the <code>ArvoTransactionError</code> class, represent critical infrastructure failures that prevent the orchestrator from maintaining its core guarantees. These errors occur during fundamental operations like event subject invalidation, lock acquisition, state rading or state persistence, where the system cannot ensure data consistency or execution isolation. When a transaction error occurs, the orchestrator immediately halts execution and throws the error upward, allowing infrastructure-level error handling to take over. This immediate propagation is crucial because these errors indicate the system cannot safely continue operation without compromising data integrity or execution guarantees.</p>
<p>System error events, on the other hand, represent workflow-level failures that occur during normal business operations. These events manifest as special sys.{source}.error type events and handle scenarios like invalid event data, contract violations, or machine execution failures. Unlike transaction errors, system error events become part of the normal event flow, allowing workflows to implement sophisticated error handling and recovery mechanisms. This approach treats workflow failures as expected business scenarios rather than exceptional cases, enabling graceful degradation and maintaining system stability. The orchestrator automatically routes these error events back to the workflow initiator, ensuring proper notification while preserving the execution context.</p>
<p>The rationale behind this separation stems from the different requirements for handling infrastructure failures versus business logic errors. Infrastructure failures require immediate attention and often indicate system-wide issues that need operational intervention. Business logic errors, while important, should be handled within the workflow's context, allowing for retry mechanisms, compensation workflows, or alternative execution paths. This dual-layer approach enables the orchestrator to maintain robust error handling while providing flexibility for workflow-specific error recovery strategies, ultimately contributing to a more resilient and maintainable system.</p>
<a id="md:telemetry-integration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Telemetry Integration<a href="#md:telemetry-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The Arvo Orchestrator implements comprehensive OpenTelemetry integration, providing deep visibility into workflow execution and system health. The telemetry system creates hierarchical spans that track each phase of execution while collecting detailed metrics about system performance. Critical measurements include lock acquisition timing, state persistence latency, event processing duration, and resource utilization patterns. This detailed monitoring enables real-time operational insights and rapid issue diagnosis while maintaining minimal overhead on workflow execution.</p>
<p>Each telemetry span captures the complete context of its execution phase, including relevant attributes and events. The hierarchical structure allows operators to trace workflow execution from initial lock acquisition through final state persistence, with clear visibility into each intermediate step. This comprehensive telemetry integration proves invaluable for performance optimization, capacity planning, and issue resolution.</p>
<a id="md:performance-optimization" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Performance Optimization<a href="#md:performance-optimization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Performance optimization in the Arvo Orchestrator centers on efficient resource utilization and careful monitoring of system behavior. The orchestrator implements sophisticated strategies for managing lock acquisition times, optimizing state persistence, and ensuring efficient event processing. Each aspect of the system undergoes regular analysis to identify bottlenecks and optimization opportunities.</p>
<p>Lock management optimization focuses on minimizing acquisition times while preventing deadlocks and ensuring fair resource distribution. State persistence strategies balance the need for consistency with performance requirements, implementing efficient storage and retrieval patterns. Event processing optimization ensures high throughput while maintaining ordering guarantees and proper context propagation.</p>
<p>Resource cleanup receives particular attention, with careful implementation ensuring timely release of system resources while maintaining system responsiveness. The telemetry system provides crucial insights for these optimization efforts, helping identify high-impact improvements while ensuring system reliability remains uncompromised.</p>
<a id="md:deployment-considerations" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Deployment Considerations<a href="#md:deployment-considerations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Deploying the Arvo Orchestrator requires careful attention to system architecture and operational requirements. The system supports various deployment patterns, from single-instance deployments for simple scenarios to sophisticated distributed configurations with shared or local state management. Each deployment pattern offers different tradeoffs between simplicity, scalability, and operational complexity.</p>
<p>Network configuration plays a crucial role in distributed deployments, requiring careful attention to latency, reliability, and security considerations. Storage requirements vary based on workflow volumes and retention needs, demanding appropriate capacity planning and backup strategies. Monitoring setup ensures comprehensive visibility into system health and performance, while backup strategies protect against data loss and enable disaster recovery.</p>
<a id="md:operational-excellence" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Operational Excellence<a href="#md:operational-excellence" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Successful operation of the Arvo Orchestrator depends on well-defined procedures and careful attention to system health. System operators should maintain comprehensive monitoring of health metrics, including lock acquisition patterns, state persistence performance, and event processing throughput. Regular analysis of these metrics helps identify trends and potential issues before they impact system reliability.</p>
<p>Incident response procedures should define clear escalation paths and resolution strategies for common failure scenarios. Documentation must remain current, capturing deployment configurations, operational procedures, and known issue resolutions. Capacity planning should consider both current requirements and future growth, ensuring the system maintains performance as demand increases.</p>
<a id="md:custom-implementation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Custom Implementation<a href="#md:custom-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The Arvo Orchestrator supports extensive customization through well-defined interfaces. Organizations can implement specialized behavior while maintaining core system guarantees through custom components:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">orchestrator</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">ArvoOrchestrator</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">executionunits:</span><span class="hl-1"> </span><span class="hl-8">1</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">memory:</span><span class="hl-1"> </span><span class="hl-5">customMemory</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">registry:</span><span class="hl-1"> </span><span class="hl-5">customRegistry</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">executionEngine:</span><span class="hl-1"> </span><span class="hl-5">customEngine</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Custom memory implementations might provide specialized storage strategies or integration with existing infrastructure. Custom registries could implement sophisticated version management or specialized machine resolution logic. Custom execution engines might provide integration with different state machine frameworks or implement specialized execution patterns.</p>
<a id="md:detailed-implementation-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Detailed Implementation Flow<a href="#md:detailed-implementation-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>For a comprehensive understanding of the ArvoOrchestrator's execution flow, sequence diagrams, and internal workings, please refer to our <a href="https://github.com/SaadAhmad123/arvo-xstate/blob/main/src/ArvoOrchestrator/ExecutionDiagrams.md" target="_blank" class="external">detailed technical diagrams</a>.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:arvoorchestrator"><span>Arvo<wbr/>Orchestrator</span></a><ul><li><a href="#md:overview"><span>Overview</span></a></li><li><a href="#md:getting-started"><span>Getting <wbr/>Started</span></a></li><li><a href="#md:multi-domain-event-broadcasting"><span>Multi-<wbr/>Domain <wbr/>Event <wbr/>Broadcasting</span></a></li><li><ul><li><a href="#md:understanding-domains"><span>Understanding <wbr/>Domains</span></a></li><li><a href="#md:domain-assignment-rules"><span>Domain <wbr/>Assignment <wbr/>Rules</span></a></li><li><a href="#md:domain-broadcasting-patterns"><span>Domain <wbr/>Broadcasting <wbr/>Patterns</span></a></li><li><a href="#md:error-broadcasting"><span>Error <wbr/>Broadcasting</span></a></li><li><a href="#md:domain-usage-example"><span>Domain <wbr/>Usage <wbr/>Example</span></a></li></ul></li><li><a href="#md:operation-overview"><span>Operation overview</span></a></li><li><a href="#md:event-routing-in-arvo-orchestrator"><span>Event <wbr/>Routing in <wbr/>Arvo <wbr/>Orchestrator</span></a></li><li><ul><li><a href="#md:core-routing-logic"><span>Core <wbr/>Routing <wbr/>Logic</span></a></li><li><a href="#md:parent-child-workflow-routing"><span>Parent-<wbr/>Child <wbr/>Workflow <wbr/>Routing</span></a></li><li><a href="#md:routing-control"><span>Routing <wbr/>Control</span></a></li></ul></li><li><a href="#md:multi-domain-event-broadcasting-1"><span>Multi-<wbr/>Domain <wbr/>Event <wbr/>Broadcasting</span></a></li><li><ul><li><a href="#md:understanding-domains-with-symbolic-resolution"><span>Understanding <wbr/>Domains with <wbr/>Symbolic <wbr/>Resolution</span></a></li><li><a href="#md:domain-resolution-and-deduplication"><span>Domain <wbr/>Resolution and <wbr/>Deduplication</span></a></li><li><a href="#md:domain-context-in-parent-child-relationships"><span>Domain <wbr/>Context in <wbr/>Parent-<wbr/>Child <wbr/>Relationships</span></a></li></ul></li><li><a href="#md:detailed-component-integration-and-operation"><span>Detailed <wbr/>Component <wbr/>Integration and <wbr/>Operation</span></a></li><li><a href="#md:error-handling-philosophy-transaction-errors-vs-system-error-events"><span>Error <wbr/>Handling <wbr/>Philosophy: <wbr/>Transaction <wbr/>Errors vs <wbr/>System <wbr/>Error <wbr/>Events</span></a></li><li><a href="#md:telemetry-integration"><span>Telemetry <wbr/>Integration</span></a></li><li><a href="#md:performance-optimization"><span>Performance <wbr/>Optimization</span></a></li><li><a href="#md:deployment-considerations"><span>Deployment <wbr/>Considerations</span></a></li><li><a href="#md:operational-excellence"><span>Operational <wbr/>Excellence</span></a></li><li><a href="#md:custom-implementation"><span>Custom <wbr/>Implementation</span></a></li><li><a href="#md:detailed-implementation-flow"><span>Detailed <wbr/>Implementation <wbr/>Flow</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-1"></use></svg><span>arvo-event-handler</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base=".."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a> with <a href="https://github.com/KillerJulian/typedoc-github-theme" target="_blank">typedoc-github-theme</a></p></footer><div class="overlay"></div></body></html>
