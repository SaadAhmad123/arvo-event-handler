<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Machine Memory | arvo-event-handler</title><meta name="description" content="Documentation for arvo-event-handler"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><link rel="stylesheet" href="../assets/typedoc-github-style.css"/></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base=".."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">arvo-event-handler</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">arvo-event-handler</a></li><li><a href="Machine_Memory.html">Machine Memory</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="md:machine-memory" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Machine Memory<a href="#md:machine-memory" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>The Machine Memory component forms the backbone of state persistence and concurrency control in the Arvo orchestration system. It embodies a carefully considered balance between reliability and simplicity, implementing an optimistic locking strategy that prioritizes system recovery over perfect consistency.</p>
<a id="md:design-philosophy" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Design Philosophy<a href="#md:design-philosophy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>State management in distributed systems presents unique challenges that require careful consideration of failure modes and recovery patterns. The Machine Memory interface adopts an optimistic approach to handling transient failures, implementing targeted retry strategies for different operations based on their impact on system consistency. Read operations employ a measured retry strategy with backoff, acknowledging that temporary unavailability should not immediately fail orchestration attempts. In contrast, write operations fail fast to maintain state consistency, as retrying writes could lead to incorrect state transitions or duplicate processing.</p>
<p>The locking mechanism follows the principle of &quot;fail fast on acquire, be tolerant on release.&quot; This approach recognizes that while acquiring a lock is a critical operation that must succeed definitively, lock release failures should not block system progress. A mandatory TTL mechanism ensures system recovery even when explicit lock releases fail, preventing resource deadlocks while maintaining processing guarantees.</p>
<a id="md:interface" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Interface<a href="#md:interface" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The IMachineMemory interface encapsulates these principles through four core operations. Each operation has specific reliability characteristics and error handling requirements derived from extensive experience with distributed orchestration systems:</p>
<pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-9">IMachineMemory</span><span class="hl-1">&lt;</span><span class="hl-9">T</span><span class="hl-1"> </span><span class="hl-6">extends</span><span class="hl-1"> </span><span class="hl-9">Record</span><span class="hl-1">&lt;</span><span class="hl-9">string</span><span class="hl-1">, </span><span class="hl-9">any</span><span class="hl-1">&gt;&gt; {</span><br/><span class="hl-1">  </span><span class="hl-0">read</span><span class="hl-1">(</span><span class="hl-5">id</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">): </span><span class="hl-9">Promise</span><span class="hl-1">&lt;</span><span class="hl-9">T</span><span class="hl-1"> | </span><span class="hl-9">null</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">write</span><span class="hl-1">(</span><span class="hl-5">id</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">, </span><span class="hl-5">data</span><span class="hl-1">: </span><span class="hl-9">T</span><span class="hl-1">): </span><span class="hl-9">Promise</span><span class="hl-1">&lt;</span><span class="hl-9">void</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">lock</span><span class="hl-1">(</span><span class="hl-5">id</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">): </span><span class="hl-9">Promise</span><span class="hl-1">&lt;</span><span class="hl-9">boolean</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">unlock</span><span class="hl-1">(</span><span class="hl-5">id</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">): </span><span class="hl-9">Promise</span><span class="hl-1">&lt;</span><span class="hl-9">boolean</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:simple-implementation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Simple Implementation<a href="#md:simple-implementation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>While the interface supports sophisticated distributed implementations, the SimpleMachineMemory class provides an in-memory reference implementation suitable for development and testing scenarios. This implementation maintains atomic operations and correct locking semantics within a single node, making it ideal for container applications and request-scoped workflows.</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">memory</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">SimpleMachineMemory</span><span class="hl-1">();</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">orchestrator</span><span class="hl-1"> = </span><span class="hl-0">createArvoOrchestrator</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">memory</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">executionunits:</span><span class="hl-1"> </span><span class="hl-8">0.1</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">machines:</span><span class="hl-1"> [</span><span class="hl-5">workflow</span><span class="hl-1">],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:production-implementations" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Production Implementations<a href="#md:production-implementations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Production deployments require careful consideration of distributed system challenges. When implementing the IMachineMemory interface for production use, several key aspects demand attention. The locking mechanism must include TTL-based expiry to prevent permanent resource locks, while read operations should implement a carefully tuned retry strategy that balances availability with responsiveness. Write operations must prioritize consistency, failing fast rather than potentially corrupting state through retry attempts.</p>
<p>Example of a Redis-based implementation considering these factors:</p>
<pre><code class="typescript"><span class="hl-6">class</span><span class="hl-1"> </span><span class="hl-9">RedisMachineMemory</span><span class="hl-1"> </span><span class="hl-6">implements</span><span class="hl-1"> </span><span class="hl-9">IMachineMemory</span><span class="hl-1">&lt;</span><span class="hl-9">MachineMemoryRecord</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-6">constructor</span><span class="hl-1">(</span><span class="hl-6">private</span><span class="hl-1"> </span><span class="hl-5">redis</span><span class="hl-1">: </span><span class="hl-9">Redis</span><span class="hl-1">) {}</span><br/><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-0">read</span><span class="hl-1">(</span><span class="hl-5">id</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1">): </span><span class="hl-9">Promise</span><span class="hl-1">&lt;</span><span class="hl-9">MachineMemoryRecord</span><span class="hl-1"> | </span><span class="hl-9">null</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-3">// Implementation with retry strategy</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-3">// Additional implementation...</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:observability-and-monitoring" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Observability and Monitoring<a href="#md:observability-and-monitoring" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The Machine Memory system plays a critical role in orchestration reliability, making observability essential. Implementations should integrate with OpenTelemetry to provide insights into operation latencies, failure rates, and lock acquisition patterns. This telemetry helps identify potential bottlenecks and system health issues before they impact reliability.</p>
<a id="md:implementation-guidelines" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Implementation Guidelines<a href="#md:implementation-guidelines" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>A successful Machine Memory implementation must carefully consider error handling, timeout configurations, and retry strategies. Read operations should implement quick retries with exponential backoff, while writes should fail fast to maintain consistency. Lock operations require careful timeout configuration with mandatory TTL mechanisms to prevent deadlocks. These guidelines emerge from practical experience with distributed orchestration systems and aim to balance reliability with operational simplicity.</p>
<p>The interface's design recognizes that perfect consistency is often less important than reliable system recovery in distributed orchestration scenarios. By providing clear behavioral contracts and implementation guidelines, it enables developers to create robust state management solutions while avoiding common distributed systems pitfalls.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:machine-memory"><span>Machine <wbr/>Memory</span></a><ul><li><a href="#md:design-philosophy"><span>Design <wbr/>Philosophy</span></a></li><li><a href="#md:interface"><span>Interface</span></a></li><li><a href="#md:simple-implementation"><span>Simple <wbr/>Implementation</span></a></li><li><a href="#md:production-implementations"><span>Production <wbr/>Implementations</span></a></li><li><a href="#md:observability-and-monitoring"><span>Observability and <wbr/>Monitoring</span></a></li><li><a href="#md:implementation-guidelines"><span>Implementation <wbr/>Guidelines</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-1"></use></svg><span>arvo-event-handler</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base=".."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a> with <a href="https://github.com/KillerJulian/typedoc-github-theme" target="_blank">typedoc-github-theme</a></p></footer><div class="overlay"></div></body></html>
